

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>44. 简单线性回归模型 &#8212; Python数量经济学入门</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/quantecon-book-theme.css?digest=bd0785fbb14d8d2bd4d9ae501d79ed8d3bc089ec" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>


    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/scripts/quantecon-book-theme.js?digest=d6d86bce9979111653c4c495e33499e1796e172a"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-QDS1YRJNGM"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-QDS1YRJNGM');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"argmax": "arg\\,max", "argmin": "arg\\,min"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'simple_linear_regression';</script>
    <link rel="canonical" href="https://intro-cn.quantecon.org/simple_linear_regression.html" />
    <link rel="shortcut icon" href="_static/lectures-favicon.ico"/>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="45. 最大似然估计" href="mle.html" />
    <link rel="prev" title="43. 市场均衡与异质性" href="supply_demand_heterogeneity.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和撰写的计算经济学入门讲座。 />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="简单线性回归模型"/>
<meta name="twitter:description" content="本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和撰写的计算经济学入门讲座。">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="简单线性回归模型" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://intro-cn.quantecon.org/simple_linear_regression.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和撰写的计算经济学入门讲座。" />
<meta property="og:site_name" content="Python数量经济学入门" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=simple_linear_regression>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha-beta">44.1. 残差相对于 <span class="math notranslate nohighlight">\(\alpha\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span> 的变化</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#slr-optimal-values">44.2. 计算最优值</a></li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo.png" class="logo logo-img" alt="logo"></a>
                                    
                                    <a href=https://quantecon.org><img src="_static/quantecon-logo-transparent.png" class="dark-logo-img" alt="logo"></a>
                                    
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">Python数量经济学入门</a></p>

                        <p class="qe-page__header-subheading">简单线性回归模型</p>

                    </div>
                    <!-- length 2, since its a string and empty dict has length 2 - {} -->
                        <p class="qe-page__header-authors" font-size="18">
                            
                                
                                    <a href="http://www.tomsargent.com/" target="_blank"><span>托马斯·萨金特（Thomas J. Sargent）</span></a>
                                
                            
                                
                                    and <a href="https://johnstachurski.net/" target="_blank"><span>约翰·斯塔胡斯基（John Stachurski）</span></a>
                                
                            
                        </p>


                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1><span class="section-number">44. </span>简单线性回归模型<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">FONTPATH</span> <span class="o">=</span> <span class="s2">&quot;fonts/SourceHanSerifSC-SemiBold.otf&quot;</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">fontManager</span><span class="o">.</span><span class="n">addfont</span><span class="p">(</span><span class="n">FONTPATH</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source Han Serif SC&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>简单回归模型估计两个变量 <span class="math notranslate nohighlight">\(x_i\)</span> 和 <span class="math notranslate nohighlight">\(y_i\)</span> 之间的关系</p>
<div class="math notranslate nohighlight">
\[
y_i = \alpha + \beta x_i + \epsilon_i, i = 1,2,...,N
\]</div>
<p>其中 <span class="math notranslate nohighlight">\(\epsilon_i\)</span> 表示最佳拟合线与样本值 <span class="math notranslate nohighlight">\(y_i\)</span> 与 <span class="math notranslate nohighlight">\(x_i\)</span> 的误差。</p>
<p>我们的目标是为 <span class="math notranslate nohighlight">\(\alpha\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span> 选择值来为一些可用的变量 <span class="math notranslate nohighlight">\(x_i\)</span> 和 <span class="math notranslate nohighlight">\(y_i\)</span> 的数据构建“最佳”拟合线。</p>
<p>让我们考虑一个具有10个观察值的简单数据集，变量为 <span class="math notranslate nohighlight">\(x_i\)</span> 和 <span class="math notranslate nohighlight">\(y_i\)</span>：</p>
<div class="pst-scrollable-table-container"><table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(y_i\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(x_i\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>2000</p></td>
<td><p>32</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>1000</p></td>
<td><p>21</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>1500</p></td>
<td><p>24</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>2500</p></td>
<td><p>35</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>500</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>900</p></td>
<td><p>11</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>1100</p></td>
<td><p>22</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>1500</p></td>
<td><p>21</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>1800</p></td>
<td><p>27</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>250</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
</div>
<p>让我们把 <span class="math notranslate nohighlight">\(y_i\)</span> 视为一个冰淇淋车的销售额，而 <span class="math notranslate nohighlight">\(x_i\)</span> 是记录当天摄氏度温度的变量。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1500</span><span class="p">,</span><span class="mi">2500</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">900</span><span class="p">,</span><span class="mi">1100</span><span class="p">,</span><span class="mi">1500</span><span class="p">,</span><span class="mi">1800</span><span class="p">,</span> <span class="mi">250</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">]</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>X</th>
      <th>Y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>32</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>21</td>
      <td>1000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>24</td>
      <td>1500</td>
    </tr>
    <tr>
      <th>3</th>
      <td>35</td>
      <td>2500</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10</td>
      <td>500</td>
    </tr>
    <tr>
      <th>5</th>
      <td>11</td>
      <td>900</td>
    </tr>
    <tr>
      <th>6</th>
      <td>22</td>
      <td>1100</td>
    </tr>
    <tr>
      <th>7</th>
      <td>21</td>
      <td>1500</td>
    </tr>
    <tr>
      <th>8</th>
      <td>27</td>
      <td>1800</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2</td>
      <td>250</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>我们可以通过数据的散点图来观察 <span class="math notranslate nohighlight">\(y_i\)</span>（冰淇淋销售额（美元($’s)）和 <span class="math notranslate nohighlight">\(x_i\)</span>（摄氏度）之间的关系。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> 
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> 
    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> 
    <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;冰淇淋销售额（\$）&#39;</span><span class="p">,</span> 
    <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;摄氏度&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<figure class="align-default" id="sales-v-temp1">
<a class="reference internal image-reference" href="_images/e5e93fcd510171f7fbd4950fc23c22909a71827cd0a26ea1bf481a3c8eecb4cd.png"><img alt="_images/e5e93fcd510171f7fbd4950fc23c22909a71827cd0a26ea1bf481a3c8eecb4cd.png" src="_images/e5e93fcd510171f7fbd4950fc23c22909a71827cd0a26ea1bf481a3c8eecb4cd.png" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 44.1 </span><span class="caption-text">散点图</span><a class="headerlink" href="#sales-v-temp1" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
<p>如您所见，数据表明在更热的日子里通常会卖出更多的冰淇淋。</p>
<p>为了建立数据的线性模型，我们需要选择代表“最佳”拟合线的 <span class="math notranslate nohighlight">\(\alpha\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span> 值，使得</p>
<div class="math notranslate nohighlight">
\[
\hat{y_i} = \hat{\alpha} + \hat{\beta} x_i
\]</div>
<p>让我们从 <span class="math notranslate nohighlight">\(\alpha = 5\)</span> 和 <span class="math notranslate nohighlight">\(\beta = 10\)</span> 开始</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">α</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">β</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y_hat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">α</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Y_hat&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\hat Y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<figure class="align-default" id="sales-v-temp2">
<a class="reference internal image-reference" href="_images/468063cda355bbddd56f1b13ddc1a67f28c47f78cf8cc8dfb85b8029108263a7.png"><img alt="_images/468063cda355bbddd56f1b13ddc1a67f28c47f78cf8cc8dfb85b8029108263a7.png" src="_images/468063cda355bbddd56f1b13ddc1a67f28c47f78cf8cc8dfb85b8029108263a7.png" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 44.2 </span><span class="caption-text">带有拟合线的散点图</span><a class="headerlink" href="#sales-v-temp2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
<p>我们可以看到这个模型在估计关系上做得很差。</p>
<p>我们可以继续通过调整参数来试图迭代并逼近“最佳”拟合线。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">β</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y_hat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">α</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Y_hat&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\hat Y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<figure class="align-default" id="sales-v-temp3">
<a class="reference internal image-reference" href="_images/24a9ea5ecff2e64e5e4b2990e38578a7a2b9ec6050f665a73b5673d0e8da99cf.png"><img alt="_images/24a9ea5ecff2e64e5e4b2990e38578a7a2b9ec6050f665a73b5673d0e8da99cf.png" src="_images/24a9ea5ecff2e64e5e4b2990e38578a7a2b9ec6050f665a73b5673d0e8da99cf.png" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 44.3 </span><span class="caption-text">带拟合线的散点图 #2</span><a class="headerlink" href="#sales-v-temp3" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">β</span> <span class="o">=</span> <span class="mi">65</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y_hat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">α</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">yax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Y_hat&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\hat Y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<figure class="align-default" id="sales-v-temp4">
<a class="reference internal image-reference" href="_images/f63b5c3ece86f59b82c8b04503b9cfdb737e92d07c925a576570bbcc7004eef1.png"><img alt="_images/f63b5c3ece86f59b82c8b04503b9cfdb737e92d07c925a576570bbcc7004eef1.png" src="_images/f63b5c3ece86f59b82c8b04503b9cfdb737e92d07c925a576570bbcc7004eef1.png" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 44.4 </span><span class="caption-text">带拟合线的散点图 #3</span><a class="headerlink" href="#sales-v-temp4" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
<p>但是我们需要考虑将这个猜测过程正式化，把这个问题看作是一个优化问题。</p>
<p>让我们考虑误差 <span class="math notranslate nohighlight">\(\epsilon_i\)</span> 并定义观测值 <span class="math notranslate nohighlight">\(y_i\)</span> 与估计值 <span class="math notranslate nohighlight">\(\hat{y}_i\)</span> 之间的差异，我们将其称为残差</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\hat{e}_i &amp;= y_i - \hat{y}_i \\
          &amp;= y_i - \hat{\alpha} - \hat{\beta} x_i
\end{aligned}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y_hat&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>X</th>
      <th>Y</th>
      <th>Y_hat</th>
      <th>error</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>32</td>
      <td>2000</td>
      <td>2085</td>
      <td>85</td>
    </tr>
    <tr>
      <th>1</th>
      <td>21</td>
      <td>1000</td>
      <td>1370</td>
      <td>370</td>
    </tr>
    <tr>
      <th>2</th>
      <td>24</td>
      <td>1500</td>
      <td>1565</td>
      <td>65</td>
    </tr>
    <tr>
      <th>3</th>
      <td>35</td>
      <td>2500</td>
      <td>2280</td>
      <td>-220</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10</td>
      <td>500</td>
      <td>655</td>
      <td>155</td>
    </tr>
    <tr>
      <th>5</th>
      <td>11</td>
      <td>900</td>
      <td>720</td>
      <td>-180</td>
    </tr>
    <tr>
      <th>6</th>
      <td>22</td>
      <td>1100</td>
      <td>1435</td>
      <td>335</td>
    </tr>
    <tr>
      <th>7</th>
      <td>21</td>
      <td>1500</td>
      <td>1370</td>
      <td>-130</td>
    </tr>
    <tr>
      <th>8</th>
      <td>27</td>
      <td>1800</td>
      <td>1760</td>
      <td>-40</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2</td>
      <td>250</td>
      <td>135</td>
      <td>-115</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">yax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Y_hat&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\hat Y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y_hat&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<figure class="align-default" id="plt-residuals">
<a class="reference internal image-reference" href="_images/9b40c1c9796b8cd275ca8bcee90a1dc046c31ef45605f0cd320d90a37b9122f0.png"><img alt="_images/9b40c1c9796b8cd275ca8bcee90a1dc046c31ef45605f0cd320d90a37b9122f0.png" src="_images/9b40c1c9796b8cd275ca8bcee90a1dc046c31ef45605f0cd320d90a37b9122f0.png" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 44.5 </span><span class="caption-text">残差图</span><a class="headerlink" href="#plt-residuals" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
<p>普通最小二乘方法 (OLS) 选择 <span class="math notranslate nohighlight">\(\alpha\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span>，以使残差平方和 (SSR) <strong>最小化</strong>。</p>
<div class="math notranslate nohighlight">
\[
\min_{\alpha,\beta} \sum_{i=1}^{N}{\hat{e}_i^2} = \min_{\alpha,\beta} \sum_{i=1}^{N}{(y_i - \alpha - \beta x_i)^2}
\]</div>
<p>我们称之为成本函数</p>
<div class="math notranslate nohighlight">
\[
C = \sum_{i=1}^{N}{(y_i - \alpha - \beta x_i)^2}
\]</div>
<p>我们希望通过参数 <span class="math notranslate nohighlight">\(\alpha\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span> 来最小化这个成本函数。</p>
<section id="alpha-beta">
<h2><span class="section-number">44.1. </span>残差相对于 <span class="math notranslate nohighlight">\(\alpha\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span> 的变化<a class="headerlink" href="#alpha-beta" title="Permalink to this heading">#</a></h2>
<p>首先让我们看看总误差相对于 <span class="math notranslate nohighlight">\(\beta\)</span> 的变化（保持截距 <span class="math notranslate nohighlight">\(\alpha\)</span> 不变）</p>
<p>我们从<a class="reference internal" href="#slr-optimal-values"><span class="std std-ref">下一节</span></a>知道 <span class="math notranslate nohighlight">\(\alpha\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span> 的最优值是：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">β_optimal</span> <span class="o">=</span> <span class="mf">64.38</span>
<span class="n">α_optimal</span> <span class="o">=</span> <span class="o">-</span><span class="mf">14.72</span>
</pre></div>
</div>
</div>
</div>
<p>我们可以计算一个范围内的 <span class="math notranslate nohighlight">\(\beta\)</span> 值的残差</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">β</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="n">errors</span><span class="p">[</span><span class="n">β</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">α_optimal</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>绘制残差图</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;β&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;残差&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">β_optimal</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<figure class="align-default" id="plt-errors">
<a class="reference internal image-reference" href="_images/233a641767a74e980b7239f1c74007309d7db6a2ef1ca9855e667efdeb374112.png"><img alt="_images/233a641767a74e980b7239f1c74007309d7db6a2ef1ca9855e667efdeb374112.png" src="_images/233a641767a74e980b7239f1c74007309d7db6a2ef1ca9855e667efdeb374112.png" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 44.6 </span><span class="caption-text">绘制残差图</span><a class="headerlink" href="#plt-errors" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
<p>现在我们改变 <span class="math notranslate nohighlight">\(\alpha\)</span> （保持 <span class="math notranslate nohighlight">\(\beta\)</span> 不变）</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">α</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">errors</span><span class="p">[</span><span class="n">α</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">α</span> <span class="o">+</span> <span class="n">β_optimal</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>绘制残差图</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;α&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;残差&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">α_optimal</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<figure class="align-default" id="plt-errors-2">
<a class="reference internal image-reference" href="_images/edd915afb3bf4d63fe48fe30a95a3935a7df289c89b10f6a0d385c282d367870.png"><img alt="_images/edd915afb3bf4d63fe48fe30a95a3935a7df289c89b10f6a0d385c282d367870.png" src="_images/edd915afb3bf4d63fe48fe30a95a3935a7df289c89b10f6a0d385c282d367870.png" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 44.7 </span><span class="caption-text">绘制残差图 (2)</span><a class="headerlink" href="#plt-errors-2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
</section>
<section id="slr-optimal-values">
<span id="id2"></span><h2><span class="section-number">44.2. </span>计算最优值<a class="headerlink" href="#slr-optimal-values" title="Permalink to this heading">#</a></h2>
<p>现在让我们使用微积分来解决优化问题，并计算出 <span class="math notranslate nohighlight">\(\alpha\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span> 的最优值，以找到普通最小二乘解。</p>
<p>首先对 <span class="math notranslate nohighlight">\(\alpha\)</span> 取偏导</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial C}{\partial \alpha}[\sum_{i=1}^{N}{(y_i - \alpha - \beta x_i)^2}]
\]</div>
<p>并将其设为 <span class="math notranslate nohighlight">\(0\)</span></p>
<div class="math notranslate nohighlight">
\[
0 = \sum_{i=1}^{N}{-2(y_i - \alpha - \beta x_i)}
\]</div>
<p>我们可以通过两边除以 <span class="math notranslate nohighlight">\(-2\)</span> 来移除求和中的常数 <span class="math notranslate nohighlight">\(-2\)</span></p>
<div class="math notranslate nohighlight">
\[
0 = \sum_{i=1}^{N}{(y_i - \alpha - \beta x_i)}
\]</div>
<p>现在我们可以将这个方程分解为各个组成部分</p>
<div class="math notranslate nohighlight">
\[
0 = \sum_{i=1}^{N}{y_i} - \sum_{i=1}^{N}{\alpha} - \beta \sum_{i=1}^{N}{x_i}
\]</div>
<p>中间项是从 <span class="math notranslate nohighlight">\(i=1,...N\)</span> 对常数 <span class="math notranslate nohighlight">\(\alpha\)</span> 进行简单求和</p>
<div class="math notranslate nohighlight">
\[
0 = \sum_{i=1}^{N}{y_i} - N*\alpha - \beta \sum_{i=1}^{N}{x_i}
\]</div>
<p>并重新排列各项</p>
<div class="math notranslate nohighlight">
\[
\alpha = \frac{\sum_{i=1}^{N}{y_i} - \beta \sum_{i=1}^{N}{x_i}}{N}
\]</div>
<p>我们观察到两个分数分别归结为均值 <span class="math notranslate nohighlight">\(\bar{y_i}\)</span> 和 <span class="math notranslate nohighlight">\(\bar{x_i}\)</span></p>
<div class="math notranslate nohighlight" id="equation-eq-optimal-alpha">
<span class="eqno">(44.1)<a class="headerlink" href="#equation-eq-optimal-alpha" title="Permalink to this equation">#</a></span>\[
\alpha = \bar{y_i} - \beta\bar{x_i}
\]</div>
<p>现在让我们对成本函数 <span class="math notranslate nohighlight">\(C\)</span> 关于 <span class="math notranslate nohighlight">\(\beta\)</span> 取偏导</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial C}{\partial \beta}[\sum_{i=1}^{N}{(y_i - \alpha - \beta x_i)^2}]
\]</div>
<p>并将其设为 <span class="math notranslate nohighlight">\(0\)</span></p>
<div class="math notranslate nohighlight">
\[
0 = \sum_{i=1}^{N}{-2 x_i (y_i - \alpha - \beta x_i)}
\]</div>
<p>我们可以再次将常数从求和中取出，并将两边除以 <span class="math notranslate nohighlight">\(-2\)</span></p>
<div class="math notranslate nohighlight">
\[
0 = \sum_{i=1}^{N}{x_i (y_i - \alpha - \beta x_i)}
\]</div>
<p>这变成了</p>
<div class="math notranslate nohighlight">
\[
0 = \sum_{i=1}^{N}{(x_i y_i - \alpha x_i - \beta x_i^2)}
\]</div>
<p>现在代入 <span class="math notranslate nohighlight">\(\alpha\)</span></p>
<div class="math notranslate nohighlight">
\[
0 = \sum_{i=1}^{N}{(x_i y_i - (\bar{y_i} - \beta \bar{x_i}) x_i - \beta x_i^2)}
\]</div>
<p>并重新排列各项</p>
<div class="math notranslate nohighlight">
\[
0 = \sum_{i=1}^{N}{(x_i y_i - \bar{y_i} x_i - \beta \bar{x_i} x_i - \beta x_i^2)}
\]</div>
<p>这可以被分成两个求和</p>
<div class="math notranslate nohighlight">
\[
0 = \sum_{i=1}^{N}(x_i y_i - \bar{y_i} x_i) + \beta \sum_{i=1}^{N}(\bar{x_i} x_i - x_i^2)
\]</div>
<p>解<span class="math notranslate nohighlight">\(\beta\)</span>得到</p>
<div class="math notranslate nohighlight" id="equation-eq-optimal-beta">
<span class="eqno">(44.2)<a class="headerlink" href="#equation-eq-optimal-beta" title="Permalink to this equation">#</a></span>\[
\beta = \frac{\sum_{i=1}^{N}(x_i y_i - \bar{y_i} x_i)}{\sum_{i=1}^{N}(x_i^2 - \bar{x_i} x_i)}
\]</div>
<p>我们现在可以使用<a class="reference internal" href="#equation-eq-optimal-alpha">(44.1)</a> 和 <a class="reference internal" href="#equation-eq-optimal-beta">(44.2)</a> 来计算<span class="math notranslate nohighlight">\(\alpha\)</span>和<span class="math notranslate nohighlight">\(\beta\)</span>的最优值</p>
<p>计算<span class="math notranslate nohighlight">\(\beta\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># 原始数据</span>

<span class="c1"># 计算样本均值</span>
<span class="n">x_bar</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">y_bar</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>现在计算10个观察值，然后求和分子和分母</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 计算求和</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_bar</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;den&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">x_bar</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
<span class="n">β</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;den&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">β</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>64.37665782493369
</pre></div>
</div>
</div>
</div>
<p>计算<span class="math notranslate nohighlight">\(\alpha\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">α</span> <span class="o">=</span> <span class="n">y_bar</span> <span class="o">-</span> <span class="n">β</span> <span class="o">*</span> <span class="n">x_bar</span>
<span class="nb">print</span><span class="p">(</span><span class="n">α</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-14.72148541114052
</pre></div>
</div>
</div>
</div>
<p>现在我们可以绘制OLS解决方案</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y_hat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">α</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y_hat&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">yax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Y_hat&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\hat Y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y_hat&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<figure class="align-default" id="plt-ols">
<a class="reference internal image-reference" href="_images/b354f127d932a904b93d5c2bd44d6524ced7770ad67006ed938a340d65f0f721.png"><img alt="_images/b354f127d932a904b93d5c2bd44d6524ced7770ad67006ed938a340d65f0f721.png" src="_images/b354f127d932a904b93d5c2bd44d6524ced7770ad67006ed938a340d65f0f721.png" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 44.8 </span><span class="caption-text">OLS最佳拟合线</span><a class="headerlink" href="#plt-ols" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
<div class="exercise admonition" id="slr-ex1">

<p class="admonition-title"><span class="caption-number">Exercise 44.1 </span></p>
<section id="exercise-content">
<p>现在您已经知道了使用OLS解决简单线性回归模型的方程，您可以开始运行自己的回归以构建<span class="math notranslate nohighlight">\(y\)</span>和<span class="math notranslate nohighlight">\(x\)</span>之间的模型了。</p>
<p>让我们考虑两个经济变量，人均GDP和预期寿命。</p>
<ol class="arabic simple">
<li><p>你认为它们之间的关系会是怎样的？</p></li>
<li><p>从<a class="reference external" href="https://ourworldindata.org">我们的世界数据中</a>搜集一些数据</p></li>
<li><p>使用<code class="docutils literal notranslate"><span class="pre">pandas</span></code>导入<code class="docutils literal notranslate"><span class="pre">csv</span></code>格式的数据，并绘制几个不同国家的图表</p></li>
<li><p>使用<a class="reference internal" href="#equation-eq-optimal-alpha">(44.1)</a> 和 <a class="reference internal" href="#equation-eq-optimal-beta">(44.2)</a>计算<span class="math notranslate nohighlight">\(\alpha\)</span>和<span class="math notranslate nohighlight">\(\beta\)</span>的最优值</p></li>
<li><p>使用OLS绘制最佳拟合线</p></li>
<li><p>解释系数并写出人均GDP和预期寿命之间关系的总结句子</p></li>
</ol>
</section>
</div>
<div class="solution admonition" id="simple_linear_regression-solution-1">

<p class="admonition-title">Solution to<a class="reference internal" href="#slr-ex1"> Exercise 44.1</a></p>
<section id="solution-content">
<p><strong>Q2:</strong> 搜集一些数据 <a class="reference external" href="https://ourworldindata.org">来自我们的世界数据</a></p>
<iframe src="https://ourworldindata.org/grapher/life-expectancy-vs-gdp-per-capita" loading="lazy" style="width: 100%; height: 600px; border: 0px none;"></iframe><p>如果你遇到困难，可以从这里下载<a class="reference download external" download="" href="https://github.com/QuantEcon/lecture-python-intro/raw/main/lectures/_static/lecture_specific/simple_linear_regression/life-expectancy-vs-gdp-per-capita.csv"><code class="xref download docutils literal notranslate"><span class="pre">数据副本</span></code></a></p>
<p><strong>Q3:</strong> 使用<code class="docutils literal notranslate"><span class="pre">pandas</span></code>导入<code class="docutils literal notranslate"><span class="pre">csv</span></code>格式的数据并绘制几个不同国家的兴趣图表</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/QuantEcon/lecture-python-intro/raw/main/lectures/_static/lecture_specific/simple_linear_regression/life-expectancy-vs-gdp-per-capita.csv&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_url</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Entity</th>
      <th>Code</th>
      <th>Year</th>
      <th>Life expectancy at birth (historical)</th>
      <th>GDP per capita</th>
      <th>417485-annotations</th>
      <th>Population (historical estimates)</th>
      <th>Continent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Abkhazia</td>
      <td>OWID_ABK</td>
      <td>2015</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1950</td>
      <td>27.7</td>
      <td>1156.0</td>
      <td>NaN</td>
      <td>7480464.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1951</td>
      <td>28.0</td>
      <td>1170.0</td>
      <td>NaN</td>
      <td>7571542.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1952</td>
      <td>28.4</td>
      <td>1189.0</td>
      <td>NaN</td>
      <td>7667534.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1953</td>
      <td>28.9</td>
      <td>1240.0</td>
      <td>NaN</td>
      <td>7764549.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1954</td>
      <td>29.2</td>
      <td>1245.0</td>
      <td>NaN</td>
      <td>7864289.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1955</td>
      <td>29.9</td>
      <td>1246.0</td>
      <td>NaN</td>
      <td>7971933.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1956</td>
      <td>30.4</td>
      <td>1278.0</td>
      <td>NaN</td>
      <td>8087730.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1957</td>
      <td>30.9</td>
      <td>1253.0</td>
      <td>NaN</td>
      <td>8210207.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Afghanistan</td>
      <td>AFG</td>
      <td>1958</td>
      <td>31.5</td>
      <td>1298.0</td>
      <td>NaN</td>
      <td>8333827.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>您可以看到从我们的世界数据下载的数据为全球各国提供了人均GDP和预期寿命数据。</p>
<p>首先从csv文件中导入几行数据以了解其结构，以便您可以选择要读取到DataFrame中的列，这通常是一个好主意。</p>
<p>您可以观察到有许多我们不需要导入的列，比如<code class="docutils literal notranslate"><span class="pre">Continent</span></code></p>
<p>那么我们来构建一个我们想要导入的列的列表</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Code&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Life expectancy at birth (historical)&#39;</span><span class="p">,</span> <span class="s1">&#39;GDP per capita&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_url</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Code</th>
      <th>Year</th>
      <th>Life expectancy at birth (historical)</th>
      <th>GDP per capita</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>OWID_ABK</td>
      <td>2015</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AFG</td>
      <td>1950</td>
      <td>27.7</td>
      <td>1156.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AFG</td>
      <td>1951</td>
      <td>28.0</td>
      <td>1170.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AFG</td>
      <td>1952</td>
      <td>28.4</td>
      <td>1189.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AFG</td>
      <td>1953</td>
      <td>28.9</td>
      <td>1240.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>62151</th>
      <td>ZWE</td>
      <td>1946</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>62152</th>
      <td>ZWE</td>
      <td>1947</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>62153</th>
      <td>ZWE</td>
      <td>1948</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>62154</th>
      <td>ZWE</td>
      <td>1949</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>62155</th>
      <td>ALA</td>
      <td>2015</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>62156 rows × 4 columns</p>
</div></div></div>
</div>
<p>有时候重命名列名可以使得在DataFrame中更容易操作</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cntry&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;life_expectancy&quot;</span><span class="p">,</span> <span class="s2">&quot;gdppc&quot;</span><span class="p">]</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cntry</th>
      <th>year</th>
      <th>life_expectancy</th>
      <th>gdppc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>OWID_ABK</td>
      <td>2015</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AFG</td>
      <td>1950</td>
      <td>27.7</td>
      <td>1156.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AFG</td>
      <td>1951</td>
      <td>28.0</td>
      <td>1170.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AFG</td>
      <td>1952</td>
      <td>28.4</td>
      <td>1189.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AFG</td>
      <td>1953</td>
      <td>28.9</td>
      <td>1240.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>62151</th>
      <td>ZWE</td>
      <td>1946</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>62152</th>
      <td>ZWE</td>
      <td>1947</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>62153</th>
      <td>ZWE</td>
      <td>1948</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>62154</th>
      <td>ZWE</td>
      <td>1949</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>62155</th>
      <td>ALA</td>
      <td>2015</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>62156 rows × 4 columns</p>
</div></div></div>
</div>
<p>我们可以看到存在<code class="docutils literal notranslate"><span class="pre">NaN</span></code>值，这表示缺失数据，所以让我们继续删除这些数据</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cntry</th>
      <th>year</th>
      <th>life_expectancy</th>
      <th>gdppc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>AFG</td>
      <td>1950</td>
      <td>27.7</td>
      <td>1156.0000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AFG</td>
      <td>1951</td>
      <td>28.0</td>
      <td>1170.0000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AFG</td>
      <td>1952</td>
      <td>28.4</td>
      <td>1189.0000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AFG</td>
      <td>1953</td>
      <td>28.9</td>
      <td>1240.0000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>AFG</td>
      <td>1954</td>
      <td>29.2</td>
      <td>1245.0000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>61960</th>
      <td>ZWE</td>
      <td>2014</td>
      <td>58.8</td>
      <td>1594.0000</td>
    </tr>
    <tr>
      <th>61961</th>
      <td>ZWE</td>
      <td>2015</td>
      <td>59.6</td>
      <td>1560.0000</td>
    </tr>
    <tr>
      <th>61962</th>
      <td>ZWE</td>
      <td>2016</td>
      <td>60.3</td>
      <td>1534.0000</td>
    </tr>
    <tr>
      <th>61963</th>
      <td>ZWE</td>
      <td>2017</td>
      <td>60.7</td>
      <td>1582.3662</td>
    </tr>
    <tr>
      <th>61964</th>
      <td>ZWE</td>
      <td>2018</td>
      <td>61.4</td>
      <td>1611.4052</td>
    </tr>
  </tbody>
</table>
<p>12445 rows × 4 columns</p>
</div></div></div>
</div>
<p>我们现在已经将我们的DataFrame的行数从62156减少到12445，删除了很多空的数据关系。</p>
<p>现在我们有一个包含一系列年份的人均寿命和人均GDP的数据集。</p>
<p>花点时间了解你实际拥有的数据总是一个好主意。</p>
<p>例如，您可能想要探索这些数据，看看是否所有国家在各年之间的报告都是一致的。</p>
<p>让我们首先看看寿命数据</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">le_years</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cntry&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;life_expectancy&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;cntry&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">unstack</span><span class="p">()[</span><span class="s1">&#39;life_expectancy&#39;</span><span class="p">]</span>
<span class="n">le_years</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>year</th>
      <th>1543</th>
      <th>1548</th>
      <th>1553</th>
      <th>1558</th>
      <th>1563</th>
      <th>1568</th>
      <th>1573</th>
      <th>1578</th>
      <th>1583</th>
      <th>1588</th>
      <th>...</th>
      <th>2009</th>
      <th>2010</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
    </tr>
    <tr>
      <th>cntry</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AFG</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>60.4</td>
      <td>60.9</td>
      <td>61.4</td>
      <td>61.9</td>
      <td>62.4</td>
      <td>62.5</td>
      <td>62.7</td>
      <td>63.1</td>
      <td>63.0</td>
      <td>63.1</td>
    </tr>
    <tr>
      <th>AGO</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>55.8</td>
      <td>56.7</td>
      <td>57.6</td>
      <td>58.6</td>
      <td>59.3</td>
      <td>60.0</td>
      <td>60.7</td>
      <td>61.1</td>
      <td>61.7</td>
      <td>62.1</td>
    </tr>
    <tr>
      <th>ALB</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>77.8</td>
      <td>77.9</td>
      <td>78.1</td>
      <td>78.1</td>
      <td>78.1</td>
      <td>78.4</td>
      <td>78.6</td>
      <td>78.9</td>
      <td>79.0</td>
      <td>79.2</td>
    </tr>
    <tr>
      <th>ARE</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>78.0</td>
      <td>78.3</td>
      <td>78.5</td>
      <td>78.7</td>
      <td>78.9</td>
      <td>79.0</td>
      <td>79.2</td>
      <td>79.3</td>
      <td>79.5</td>
      <td>79.6</td>
    </tr>
    <tr>
      <th>ARG</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>75.9</td>
      <td>75.7</td>
      <td>76.1</td>
      <td>76.5</td>
      <td>76.5</td>
      <td>76.8</td>
      <td>76.8</td>
      <td>76.3</td>
      <td>76.8</td>
      <td>77.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>VNM</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>73.5</td>
      <td>73.5</td>
      <td>73.7</td>
      <td>73.7</td>
      <td>73.8</td>
      <td>73.9</td>
      <td>73.9</td>
      <td>73.9</td>
      <td>74.0</td>
      <td>74.0</td>
    </tr>
    <tr>
      <th>YEM</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>67.2</td>
      <td>67.3</td>
      <td>67.4</td>
      <td>67.3</td>
      <td>67.5</td>
      <td>67.4</td>
      <td>65.9</td>
      <td>66.1</td>
      <td>66.0</td>
      <td>64.6</td>
    </tr>
    <tr>
      <th>ZAF</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>57.4</td>
      <td>58.9</td>
      <td>60.7</td>
      <td>61.8</td>
      <td>62.5</td>
      <td>63.4</td>
      <td>63.9</td>
      <td>64.7</td>
      <td>65.4</td>
      <td>65.7</td>
    </tr>
    <tr>
      <th>ZMB</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>55.3</td>
      <td>56.8</td>
      <td>57.8</td>
      <td>58.9</td>
      <td>59.9</td>
      <td>60.7</td>
      <td>61.2</td>
      <td>61.8</td>
      <td>62.1</td>
      <td>62.3</td>
    </tr>
    <tr>
      <th>ZWE</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>48.1</td>
      <td>50.7</td>
      <td>53.3</td>
      <td>55.6</td>
      <td>57.5</td>
      <td>58.8</td>
      <td>59.6</td>
      <td>60.3</td>
      <td>60.7</td>
      <td>61.4</td>
    </tr>
  </tbody>
</table>
<p>166 rows × 310 columns</p>
</div></div></div>
</div>
<p>如您所见，有很多国家在1543年的数据是不可用的！</p>
<p>哪个国家报告了这些数据？</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">le_years</span><span class="p">[</span><span class="o">~</span><span class="n">le_years</span><span class="p">[</span><span class="mi">1543</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>year</th>
      <th>1543</th>
      <th>1548</th>
      <th>1553</th>
      <th>1558</th>
      <th>1563</th>
      <th>1568</th>
      <th>1573</th>
      <th>1578</th>
      <th>1583</th>
      <th>1588</th>
      <th>...</th>
      <th>2009</th>
      <th>2010</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
    </tr>
    <tr>
      <th>cntry</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>GBR</th>
      <td>33.94</td>
      <td>38.82</td>
      <td>39.59</td>
      <td>22.38</td>
      <td>36.66</td>
      <td>39.67</td>
      <td>41.06</td>
      <td>41.56</td>
      <td>42.7</td>
      <td>37.05</td>
      <td>...</td>
      <td>80.2</td>
      <td>80.4</td>
      <td>80.8</td>
      <td>80.9</td>
      <td>80.9</td>
      <td>81.2</td>
      <td>80.9</td>
      <td>81.1</td>
      <td>81.2</td>
      <td>81.1</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 310 columns</p>
</div></div></div>
</div>
<p>您可以看到，只有大不列颠（GBR）是可用的</p>
<p>您还可以更仔细地观察时间序列，发现即使对于GBR，它也是不连续的。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">le_years</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;GBR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;year&#39;&gt;
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/e29efce71435159f40e3a8cb843b6fd3e515accb141acb5477d55270be444e57.png"><img alt="_images/e29efce71435159f40e3a8cb843b6fd3e515accb141acb5477d55270be444e57.png" src="_images/e29efce71435159f40e3a8cb843b6fd3e515accb141acb5477d55270be444e57.png" style="width: 80%;" /></a>
</div>
</div>
<p>实际上我们可以使用pandas快速检查每个年份涵盖了多少个国家</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">le_years</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Number of countries&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="_images/6c1fb4b4100bd37e47b56b574bc053c2574985cfe1679bed24a60825867f4445.png"><img alt="_images/6c1fb4b4100bd37e47b56b574bc053c2574985cfe1679bed24a60825867f4445.png" src="_images/6c1fb4b4100bd37e47b56b574bc053c2574985cfe1679bed24a60825867f4445.png" style="width: 80%;" /></a>
</div>
</div>
<p>所以很明显，如果你进行横断面比较，那么最近的数据将包括更广泛的国家集合</p>
<p>现在让我们考虑数据集中最近的一年2018</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2018</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;gdppc&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;life_expectancy&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;GDP per capita&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Life expectancy (years)&quot;</span><span class="p">,);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="_images/38aab775680b5f5afcc9ef436ddae6b122b7850f664ed48ce88d6397f3606a30.png"><img alt="_images/38aab775680b5f5afcc9ef436ddae6b122b7850f664ed48ce88d6397f3606a30.png" src="_images/38aab775680b5f5afcc9ef436ddae6b122b7850f664ed48ce88d6397f3606a30.png" style="width: 80%;" /></a>
</div>
</div>
<p>这些数据显示了一些有趣的关系。</p>
<ol class="arabic simple">
<li><p>许多国家的人均GDP相近，但寿命差别很大</p></li>
<li><p>人均GDP与预期寿命之间似乎存在正向关系。人均GDP较高的国家往往拥有更高的预期寿命</p></li>
</ol>
<p>尽管普通最小二乘法（OLS）是用来解线性方程的，但我们可以通过对变量进行转换（例如对数变换），然后使用OLS来估计转换后的变量。</p>
<p>通过指定 <code class="docutils literal notranslate"><span class="pre">logx</span></code> 你可以在对数尺度上绘制人均GDP数据</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;gdppc&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;life_expectancy&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span>  <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;人均GDP&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;预期寿命（年）&quot;</span><span class="p">,</span> <span class="n">logx</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="_images/2afe42f3eff5cd374569030663c50ded6aa924aa677b07cd6e36dd48913f3f49.png"><img alt="_images/2afe42f3eff5cd374569030663c50ded6aa924aa677b07cd6e36dd48913f3f49.png" src="_images/2afe42f3eff5cd374569030663c50ded6aa924aa677b07cd6e36dd48913f3f49.png" style="width: 80%;" /></a>
</div>
</div>
<p>从这次转换可以看出，线性模型更贴近数据的形状。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;log_gdppc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gdppc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cntry</th>
      <th>year</th>
      <th>life_expectancy</th>
      <th>gdppc</th>
      <th>log_gdppc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AFG</td>
      <td>2018</td>
      <td>63.1</td>
      <td>1934.5550</td>
      <td>3.286581</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ALB</td>
      <td>2018</td>
      <td>79.2</td>
      <td>11104.1660</td>
      <td>4.045486</td>
    </tr>
    <tr>
      <th>2</th>
      <td>DZA</td>
      <td>2018</td>
      <td>76.1</td>
      <td>14228.0250</td>
      <td>4.153145</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AGO</td>
      <td>2018</td>
      <td>62.1</td>
      <td>7771.4420</td>
      <td>3.890502</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ARG</td>
      <td>2018</td>
      <td>77.0</td>
      <td>18556.3830</td>
      <td>4.268493</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>161</th>
      <td>VNM</td>
      <td>2018</td>
      <td>74.0</td>
      <td>6814.1420</td>
      <td>3.833411</td>
    </tr>
    <tr>
      <th>162</th>
      <td>OWID_WRL</td>
      <td>2018</td>
      <td>72.6</td>
      <td>15212.4150</td>
      <td>4.182198</td>
    </tr>
    <tr>
      <th>163</th>
      <td>YEM</td>
      <td>2018</td>
      <td>64.6</td>
      <td>2284.8900</td>
      <td>3.358865</td>
    </tr>
    <tr>
      <th>164</th>
      <td>ZMB</td>
      <td>2018</td>
      <td>62.3</td>
      <td>3534.0337</td>
      <td>3.548271</td>
    </tr>
    <tr>
      <th>165</th>
      <td>ZWE</td>
      <td>2018</td>
      <td>61.4</td>
      <td>1611.4052</td>
      <td>3.207205</td>
    </tr>
  </tbody>
</table>
<p>166 rows × 5 columns</p>
</div></div></div>
</div>
<p><strong>Q4:</strong> 使用 <a class="reference internal" href="#equation-eq-optimal-alpha">(44.1)</a> 和 <a class="reference internal" href="#equation-eq-optimal-beta">(44.2)</a> 来计算  <span class="math notranslate nohighlight">\(\alpha\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span> 的最优值</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;log_gdppc&#39;</span><span class="p">,</span> <span class="s1">&#39;life_expectancy&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># 从DataFrame中提取数据</span>

<span class="c1"># 计算样本均值</span>
<span class="n">x_bar</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;log_gdppc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">y_bar</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;life_expectancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>log_gdppc</th>
      <th>life_expectancy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.286581</td>
      <td>63.1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.045486</td>
      <td>79.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.153145</td>
      <td>76.1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.890502</td>
      <td>62.1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.268493</td>
      <td>77.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>161</th>
      <td>3.833411</td>
      <td>74.0</td>
    </tr>
    <tr>
      <th>162</th>
      <td>4.182198</td>
      <td>72.6</td>
    </tr>
    <tr>
      <th>163</th>
      <td>3.358865</td>
      <td>64.6</td>
    </tr>
    <tr>
      <th>164</th>
      <td>3.548271</td>
      <td>62.3</td>
    </tr>
    <tr>
      <th>165</th>
      <td>3.207205</td>
      <td>61.4</td>
    </tr>
  </tbody>
</table>
<p>166 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 计算求和</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;log_gdppc&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;life_expectancy&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_bar</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;log_gdppc&#39;</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;den&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;log_gdppc&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">x_bar</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;log_gdppc&#39;</span><span class="p">]</span>
<span class="n">β</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;den&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">β</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>12.643730292819708
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">α</span> <span class="o">=</span> <span class="n">y_bar</span> <span class="o">-</span> <span class="n">β</span> <span class="o">*</span> <span class="n">x_bar</span>
<span class="nb">print</span><span class="p">(</span><span class="n">α</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>21.70209670138904
</pre></div>
</div>
</div>
</div>
<p><strong>Q5:</strong> 绘制使用 OLS 找到的最佳拟合线</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;life_expectancy_hat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">α</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;log_gdppc&#39;</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;life_expectancy_hat&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;life_expectancy&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;log_gdppc&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;life_expectancy&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;log_gdppc&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;life_expectancy_hat&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;log_gdppc&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;life_expectancy_hat&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;life_expectancy&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.LineCollection at 0x7f11d01bbd40&gt;
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/3ea9e13da91c98b81b8fcdd4e0e9c6a8be3cbe88f4e43f770429cda0ca753674.png"><img alt="_images/3ea9e13da91c98b81b8fcdd4e0e9c6a8be3cbe88f4e43f770429cda0ca753674.png" src="_images/3ea9e13da91c98b81b8fcdd4e0e9c6a8be3cbe88f4e43f770429cda0ca753674.png" style="width: 80%;" /></a>
</div>
</div>
</section>
</div>
<div class="exercise admonition" id="slr-ex2">

<p class="admonition-title"><span class="caption-number">Exercise 44.2 </span></p>
<section id="exercise-content">
<p>通过最小化平方和并不是生成最佳拟合线的<strong>唯一</strong>方法。</p>
<p>例如，我们还可以考虑最小化<strong>绝对值之和</strong>，这样对异常值的权重会更小。</p>
<p>求解 <span class="math notranslate nohighlight">\(\alpha\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span> 使用最小绝对值法</p>
</section>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  导言
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="about.html">
   1. 关于这些讲座
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  经济数据
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="long_run_growth.html">
   2. 长期增长
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="business_cycle.html">
   3. 商业周期
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="inflation_history.html">
   4. 价格水平历史
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="french_rev.html">
   5. 法国大革命期间的通货膨胀
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="inequality.html">
   6. 收入与财富不平等
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  基础工具
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="intro_supply_demand.html">
   7. 供给与需求导论
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_equations.html">
   8. 线性方程和矩阵代数
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="complex_and_trig.html">
   9. 复数和三角函数
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="geom_series.html">
   10. 基础经济学中的几何级数
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  线性动态：有限视界
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="pv.html">
   11. 现值
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cons_smooth.html">
   12. 消费平滑
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="equalizing_difference.html">
   13. 均衡差异模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cagan_ree.html">
   14. 价格水平的货币主义理论
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cagan_adaptive.html">
   15. 具有自适应预期的价格水平货币主义理论
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  线性动态：无限视界
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="eigen_I.html">
   16. 特征值和特征向量
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="greek_square.html">
   17. 计算平方根
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  概率与分布
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="prob_dist.html">
   18. 分布和概率
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lln_clt.html">
   19. 大数定律与中心极限定理
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="monte_carlo.html">
   20. 蒙特卡罗方法与期权定价
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="heavy_tails.html">
   21. 重尾分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="schelling.html">
   22. 种族隔离
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  非线性动态
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="scalar_dynam.html">
   23. 一维动力学
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="solow.html">
   24. 索洛-斯旺增长模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cobweb.html">
   25. 蛛网模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="olg.html">
   26. 世代交叠模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="commod_price.html">
   27. 商品价格
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  货币政策与财政政策的相互作用
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="money_inflation.html">
   28. 通过货币资助的政府赤字和价格水平
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="unpleasant.html">
   29. 一些不愉快的货币主义算术
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="money_inflation_nonlinear.html">
   30. 通货膨胀税拉弗曲线
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="laffer_adaptive.html">
   31. 拉弗曲线与自适应预期
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  随机动态
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_processes.html">
   32. AR(1) 过程
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_chains_I.html">
   33. 马尔科夫链：基本概念
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_chains_II.html">
   34. 马尔科夫链：不可约性与遍历性
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="time_series_with_matrices.html">
   35. 用矩阵代数表示的单变量时间序列
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  优化
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lp_intro.html">
   36. 线性规划
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="short_path.html">
   37. 最短路径
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  高维建模
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="eigen_II.html">
   38. 佩龙-弗罗贝尼乌斯定理
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="input_output.html">
   39. 输入-输出模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lake_model.html">
   40. 就业的湖泊模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="networks.html">
   41. 网络
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  市场与竞争性均衡
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="supply_demand_multiple_goods.html">
   42. 多种商品的供需关系
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="supply_demand_heterogeneity.html">
   43. 市场均衡与异质性
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  估计
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   44. 简单线性回归模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mle.html">
   45. 最大似然估计
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  其它
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   46. 故障排除
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   47. 参考文献
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   48. 执行统计数据
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                </ul>

                <ul class="qe-toolbar__links">
                    <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off" accesskey="k">
                            <i data-feather="search" id="search-icon"></i>
                        </form>
                    </li>
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/simple_linear_regression.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li data-tippy-content="Download PDF" onClick="window.print()"><i data-feather="file"></i></li>
                    <!--
                    # Enable if looking for link to specific document hosted on GitHub
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python-intro/simple_linear_regression.md" download><i data-feather="github"></i></a></li>
                    -->
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python-intro" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://mybinder.org/v2/gh/QuantEcon/lecture-python-intro.notebooks/main?urlpath=tree/simple_linear_regression.ipynb">BinderHub</option>
                
                    <option value="https://colab.research.google.com/github/QuantEcon/lecture-python-intro.notebooks/blob/main/simple_linear_regression.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-python-intro.notebooks" data-urlpath="tree/lecture-python-intro.notebooks/simple_linear_regression.ipynb" data-branch=main>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://colab.research.google.com/github/QuantEcon/lecture-python-intro.notebooks/blob/main/simple_linear_regression.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "simple_linear_regression";
                const repoURL = "https://github.com/QuantEcon/lecture-python-intro.notebooks";
                const urlPath = "tree/lecture-python-intro.notebooks/simple_linear_regression.ipynb";
                const branch = "main"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>