

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>34. 马尔科夫链：不可约性与遍历性 &#8212; Python数量经济学入门</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/quantecon-book-theme.css?digest=bd0785fbb14d8d2bd4d9ae501d79ed8d3bc089ec" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>


    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/scripts/quantecon-book-theme.js?digest=d9faaf6c4b57726f74ba012412af1f5681bdff87"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"argmax": "arg\\,max", "argmin": "arg\\,min"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'markov_chains_II';</script>
    <link rel="canonical" href="https://quantecon.github.io/lecture-intro.zh-cn/markov_chains_II.html" />
    <link rel="shortcut icon" href="_static/lectures-favicon.ico"/>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="35. 用矩阵代数表示的单变量时间序列" href="time_series_with_matrices.html" />
    <link rel="prev" title="33. 马尔科夫链：基本概念" href="markov_chains_I.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和撰写的计算经济学入门讲座。 />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="马尔科夫链：不可约性与遍历性"/>
<meta name="twitter:description" content="本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和撰写的计算经济学入门讲座。">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="马尔科夫链：不可约性与遍历性" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://quantecon.github.io/lecture-intro.zh-cn/markov_chains_II.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和撰写的计算经济学入门讲座。" />
<meta property="og:site_name" content="Python数量经济学入门" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>

<!-- Override QuantEcon theme colors -->

    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=markov_chains_II>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">34.1. 概述</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mc-irreducible">34.2. 不可约性</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">34.2.1. 不可约性与平稳性</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ergodicity">34.3. 遍历性</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mc-eg1-2">34.3.1. 示例：遍历性与失业</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ergo">34.3.2. 示例：汉密尔顿动力学</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">34.3.3. 示例：一个周期链</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">34.3.4. 示例：政治制度</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">34.4. 练习</a></li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo.png" class="logo logo-img" alt="logo"></a>
                                    
                                    <a href=https://quantecon.org><img src="_static/quantecon-logo-transparent.png" class="dark-logo-img" alt="logo"></a>
                                    
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">Python数量经济学入门</a></p>

                        <p class="qe-page__header-subheading">马尔科夫链：不可约性与遍历性</p>

                    </div>
                    <!-- length 2, since its a string and empty dict has length 2 - {} -->
                        <p class="qe-page__header-authors" font-size="18">
                            
                                
                                    <a href="http://www.tomsargent.com/" target="_blank"><span>托马斯·萨金特（Thomas J. Sargent）</span></a>
                                
                            
                                
                                    and <a href="https://johnstachurski.net/" target="_blank"><span>约翰·斯塔胡斯基（John Stachurski）</span></a>
                                
                            
                        </p>


                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1><span class="section-number">34. </span>马尔科夫链：不可约性与遍历性<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h1>
<p id="index-0">除了 Anaconda 中的函数库外，这个讲座还需要以下函数库：</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>quantecon
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: quantecon in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (0.8.0)
Requirement already satisfied: numba&gt;=0.49.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from quantecon) (0.60.0)
Requirement already satisfied: numpy&gt;=1.17.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from quantecon) (1.26.4)
Requirement already satisfied: requests in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from quantecon) (2.32.3)
Requirement already satisfied: scipy&gt;=1.5.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from quantecon) (1.13.1)
Requirement already satisfied: sympy in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from quantecon) (1.13.2)
Requirement already satisfied: llvmlite&lt;0.44,&gt;=0.43.0dev0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from numba&gt;=0.49.0-&gt;quantecon) (0.43.0)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from requests-&gt;quantecon) (3.3.2)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from requests-&gt;quantecon) (3.7)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from requests-&gt;quantecon) (2.2.3)
Requirement already satisfied: certifi&gt;=2017.4.17 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from requests-&gt;quantecon) (2024.8.30)
Requirement already satisfied: mpmath&lt;1.4,&gt;=1.1.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from sympy-&gt;quantecon) (1.3.0)
</pre></div>
</div>
</div>
</details>
</div>
<section id="id2">
<h2><span class="section-number">34.1. </span>概述<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<p>本讲座是我们<a class="reference internal" href="markov_chains_I.html"><span class="doc">之前关于马尔科夫链的讲座</span></a>的延续。</p>
<p>具体来说，我们将介绍不可约性和遍历性的概念，并了解它们与平稳性的联系。</p>
<p>不可约性描述了马尔科夫链在系统中任意两个状态之间移动的能力。</p>
<p>遍历性是一种样本路径性质，描述了系统在长时间内的行为。</p>
<p>正如我们将看到的：</p>
<ul class="simple">
<li><p>不可约的马尔科夫链保证唯一的平稳分布存在，而</p></li>
<li><p>具有遍历性的马尔科夫链可以生成满足大数定律的时间序列。</p></li>
</ul>
<p>这些概念一起为理解马尔科夫链的长期表现提供了基础。</p>
<p>让我们从一些通常的函数库导入开始：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">quantecon</span> <span class="k">as</span> <span class="nn">qe</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="n">FONTPATH</span> <span class="o">=</span> <span class="s2">&quot;fonts/SourceHanSerifSC-SemiBold.otf&quot;</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">fontManager</span><span class="o">.</span><span class="n">addfont</span><span class="p">(</span><span class="n">FONTPATH</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source Han Serif SC&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mc-irreducible">
<span id="id3"></span><h2><span class="section-number">34.2. </span>不可约性<a class="headerlink" href="#mc-irreducible" title="Permalink to this heading">#</a></h2>
<p>为了解释不可约性，让我们设 <span class="math notranslate nohighlight">\(P\)</span> 为一个固定的随机矩阵。</p>
<p>如果对于某个整数 <span class="math notranslate nohighlight">\(t\ge 0\)</span>，<span class="math notranslate nohighlight">\(P^t(x,y)&gt;0\)</span>，则称状态 <span class="math notranslate nohighlight">\(x\)</span> 对状态 <span class="math notranslate nohighlight">\(y\)</span> 是<strong>可达</strong>的。</p>
<p>当状态 <span class="math notranslate nohighlight">\(x\)</span> 和 <span class="math notranslate nohighlight">\(y\)</span> 彼此可达时，称它们<strong>互通</strong>。</p>
<p>根据我们<a class="reference internal" href="markov_chains_I.html#finite-mc-mstp"><span class="std std-ref">前面讨论的</span></a>，这正意味着</p>
<ul class="simple">
<li><p>状态 <span class="math notranslate nohighlight">\(x\)</span> 最终可以从状态 <span class="math notranslate nohighlight">\(y\)</span> 到达，且</p></li>
<li><p>状态 <span class="math notranslate nohighlight">\(y\)</span> 最终可以从状态 <span class="math notranslate nohighlight">\(x\)</span> 到达。</p></li>
</ul>
<p>如果所有状态都互通，则称随机矩阵 <span class="math notranslate nohighlight">\(P\)</span> 是<strong>不可约</strong>的，即对于所有 在 <span class="math notranslate nohighlight">\(S \times S\)</span> 空间中的 <span class="math notranslate nohighlight">\((x, y)\)</span>，<span class="math notranslate nohighlight">\(x\)</span> 的 <span class="math notranslate nohighlight">\(y\)</span> 互通。</p>
<div class="proof example admonition" id="mc2_ex_ir">
<p class="admonition-title"><span class="caption-number">Example 34.1 </span></p>
<section class="example-content" id="proof-content">
<p>例如，考虑下面虚构的一组家庭的财富状况转移概率。</p>
<img alt="_images/Irre_1.png" class="align-center" id="mc-irre1" src="_images/Irre_1.png" />
<p>我们可以将其转化为一个随机矩阵，用0填充对应节点之间没有边线连接的地方。</p>
<div class="math notranslate nohighlight">
\[\begin{split}
P :=
\begin{bmatrix} 
     0.9 &amp; 0.1 &amp; 0 \\
     0.4 &amp; 0.4 &amp; 0.2 \\
     0.1 &amp; 0.1 &amp; 0.8
\end{bmatrix} 
\end{split}\]</div>
<p>从图中可以看出，这个随机矩阵是不可约的：我们可以最终（步数足够大）从其中任何状态到达任何其他状态。</p>
</section>
</div><p>我们还可以使用 <a class="reference external" href="http://quantecon.org/quantecon-py">QuantEcon.py</a> 的 <code class="docutils literal notranslate"><span class="pre">MarkovChain</span></code> python类来测试这一点：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
     <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
     <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]]</span>

<span class="n">mc</span> <span class="o">=</span> <span class="n">qe</span><span class="o">.</span><span class="n">MarkovChain</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;poor&#39;</span><span class="p">,</span> <span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="s1">&#39;rich&#39;</span><span class="p">))</span>
<span class="n">mc</span><span class="o">.</span><span class="n">is_irreducible</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="proof example admonition" id="mc2_ex_pf">
<p class="admonition-title"><span class="caption-number">Example 34.2 </span></p>
<section class="example-content" id="proof-content">
<p>这是一个更加悲观的情景，贫困者永远保持贫困。</p>
<img alt="_images/Irre_2.png" class="align-center" id="mc-irre2" src="_images/Irre_2.png" />
<p>这个随机矩阵不是不可约的，因为例如，富有状态无法从贫困状态直接到达。</p>
</section>
</div><p>让我们确认这一点：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
     <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
     <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]]</span>

<span class="n">mc</span> <span class="o">=</span> <span class="n">qe</span><span class="o">.</span><span class="n">MarkovChain</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;poor&#39;</span><span class="p">,</span> <span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="s1">&#39;rich&#39;</span><span class="p">))</span>
<span class="n">mc</span><span class="o">.</span><span class="n">is_irreducible</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>你可能已经明白，不可约性在长期结果中非常重要。</p>
<p>例如，在第二个图中，贫困是一种终身的困境，但在第一个图中不是。</p>
<p>我们稍后会回到这个问题。</p>
<section id="id4">
<h3><span class="section-number">34.2.1. </span>不可约性与平稳性<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h3>
<p>我们在之前的讲座 <a class="reference internal" href="markov_chains_I.html"><span class="doc">马尔科夫链：基本概念</span></a> 中讨论了平稳分布的唯一性。</p>
<p>我们<a class="reference internal" href="markov_chains_I.html#mc_po_conv_thm">指出</a>，当转移矩阵处处为正时，唯一性成立。</p>
<p>事实上，不可约性就足够了：</p>
<div class="proof theorem admonition" id="mc_conv_thm">
<p class="admonition-title"><span class="caption-number">Theorem 34.1 </span></p>
<section class="theorem-content" id="proof-content">
<p>如果 <span class="math notranslate nohighlight">\(P\)</span> 是不可约的，那么 <span class="math notranslate nohighlight">\(P\)</span> 只有一个平稳分布。</p>
</section>
</div><p>有关证明，请参见 <span id="id5">[<a class="reference internal" href="zreferences.html#id24" title="Thomas J Sargent and John Stachurski. Economic networks: theory and computation. arXiv preprint arXiv:2203.11972, 2023.">Sargent and Stachurski, 2023</a>]</span> 的第4章或 <span id="id6">[<a class="reference internal" href="zreferences.html#id155" title="Olle Häggström. Finite Markov chains and algorithmic applications. Volume 52. Cambridge University Press, 2002.">Häggström, 2002</a>]</span> 的定理5.2。</p>
</section>
</section>
<section id="ergodicity">
<span id="id7"></span><h2><span class="section-number">34.3. </span>遍历性<a class="headerlink" href="#ergodicity" title="Permalink to this heading">#</a></h2>
<p>在不可约性下，还可以得到另一个重要结果：</p>
<div class="proof theorem admonition" id="stationary">
<p class="admonition-title"><span class="caption-number">Theorem 34.2 </span></p>
<section class="theorem-content" id="proof-content">
<p>如果 <span class="math notranslate nohighlight">\(P\)</span> 是不可约的，并且 <span class="math notranslate nohighlight">\(\psi^*\)</span> 是唯一的平稳分布，那么对于所有 <span class="math notranslate nohighlight">\(x \in S\)</span>，</p>
<div class="math notranslate nohighlight" id="equation-llnfmc0">
<span class="eqno">(34.1)<a class="headerlink" href="#equation-llnfmc0" title="Permalink to this equation">#</a></span>\[\frac{1}{m} \sum_{t = 1}^m \mathbb{1}\{X_t = x\}  \to \psi^*(x)
    \quad \text{当 } m \to \infty\]</div>
</section>
</div><p>这里</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\{X_t\}\)</span> 是具有随机矩阵 <span class="math notranslate nohighlight">\(P\)</span> 和初始分布 <span class="math notranslate nohighlight">\(\psi_0\)</span> 的马尔科夫链。</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbb{1} \{X_t = x\} = 1\)</span> 当且仅当 <span class="math notranslate nohighlight">\(X_t = x\)</span>，否则为0。</p></li>
</ul>
<p>定理<a class="reference internal" href="#equation-llnfmc0">(34.1)</a>中的结果有时称为<strong>遍历性</strong>。</p>
<p>该定理告诉我们，随着时间趋于无穷大，链花费在状态 <span class="math notranslate nohighlight">\(x\)</span> 的时间比例收敛到 <span class="math notranslate nohighlight">\(\psi^*(x)\)</span>。</p>
<p id="new-interp-sd">这为我们提供了另一种解释平稳分布的方法（假设不可约性成立）。</p>
<p>重要的是，这一结果对于任何 <span class="math notranslate nohighlight">\(\psi_0\)</span> 都有效。</p>
<p>该定理与<a class="reference internal" href="lln_clt.html"><span class="doc">大数定律</span></a>相关。</p>
<p>它告诉我们，在某些情况中，即使随机变量序列<a class="reference internal" href="lln_clt.html#iid-violation"><span class="std std-ref">不是独立同分布</span></a>，大数定律有时也成立。</p>
<section id="mc-eg1-2">
<span id="id8"></span><h3><span class="section-number">34.3.1. </span>示例：遍历性与失业<a class="headerlink" href="#mc-eg1-2" title="Permalink to this heading">#</a></h3>
<p>回顾我们关于就业/失业模型的截面解释<a class="reference internal" href="markov_chains_I.html#mc-eg1-1"><span class="std std-ref">之前讨论过</span></a>。</p>
<p>假设 <span class="math notranslate nohighlight">\(\alpha \in (0,1)\)</span> 且 <span class="math notranslate nohighlight">\(\beta \in (0,1)\)</span>，因此不可约性成立。</p>
<p>我们看到平稳分布是 <span class="math notranslate nohighlight">\((p, 1-p)\)</span>，其中</p>
<div class="math notranslate nohighlight">
\[
p = \frac{\beta}{\alpha + \beta}
\]</div>
<p>在截面解释中，这是失业人员的比例。</p>
<p>根据我们最新的遍历性结果，这也是单个工人预期花费在失业状态的时间比例。</p>
<p>因此，从长远来看，人口的截面平均值和单个个体的时间序列平均值是一致的。</p>
<p>这是遍历性概念的一个方面。</p>
</section>
<section id="ergo">
<span id="id9"></span><h3><span class="section-number">34.3.2. </span>示例：汉密尔顿动力学<a class="headerlink" href="#ergo" title="Permalink to this heading">#</a></h3>
<p>另一个示例是我们<a class="reference internal" href="markov_chains_I.html#mc-eg2"><span class="std std-ref">之前讨论过的</span></a>汉密尔顿动力学。</p>
<p>让 <span class="math notranslate nohighlight">\(\{X_t\}\)</span> 是由这些动力学生成的样本路径。</p>
<p>令在时间段 <span class="math notranslate nohighlight">\(t=1, \ldots, n\)</span> 内花费在状态 <span class="math notranslate nohighlight">\(x\)</span> 上的时间比例为 <span class="math notranslate nohighlight">\(\hat p_n(x)\)</span>，则有</p>
<div class="math notranslate nohighlight">
\[
    \hat p_n(x) := \frac{1}{n} \sum_{t = 1}^n \mathbb{1}\{X_t = x\}
    \qquad (x \in \{0, 1, 2\})
\]</div>
<p>马尔科夫链的<a class="reference internal" href="markov_chains_I.html#mc-eg2"><span class="std std-ref">图</span></a>表明它是不可约的，因此遍历性成立。</p>
<p>因此，我们期望当 <span class="math notranslate nohighlight">\(n\)</span> 较大时，<span class="math notranslate nohighlight">\(\hat p_n(x) \approx \psi^*(x)\)</span>。</p>
<p>下图显示了当 <span class="math notranslate nohighlight">\(x=1\)</span> 并且 <span class="math notranslate nohighlight">\(X_0\)</span> 分别为 <span class="math notranslate nohighlight">\(0, 1\)</span> 或 <span class="math notranslate nohighlight">\(2\)</span> 时，<span class="math notranslate nohighlight">\(\hat p_n(x)\)</span> 向 <span class="math notranslate nohighlight">\(\psi^*(x)\)</span> 的收敛情况。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.971</span><span class="p">,</span> <span class="mf">0.029</span><span class="p">,</span> <span class="mf">0.000</span><span class="p">],</span>
              <span class="p">[</span><span class="mf">0.145</span><span class="p">,</span> <span class="mf">0.778</span><span class="p">,</span> <span class="mf">0.077</span><span class="p">],</span>
              <span class="p">[</span><span class="mf">0.000</span><span class="p">,</span> <span class="mf">0.508</span><span class="p">,</span> <span class="mf">0.492</span><span class="p">]])</span>
<span class="n">ts_length</span> <span class="o">=</span> <span class="mi">10_000</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">qe</span><span class="o">.</span><span class="n">MarkovChain</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="n">ψ_star</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">stationary_distributions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># 我们研究 psi^*(x) 的收敛情况</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">ψ_star</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                <span class="n">label</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;$\psi^*(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">)$&#39;</span><span class="p">)</span>
<span class="c1"># 计算花费在状态0的时间比例，从不同的x_0开始</span>
<span class="k">for</span> <span class="n">x0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">ts_length</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">x0</span><span class="p">)</span>
    <span class="n">p_hat</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ts_length</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p_hat</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$\hat p_n(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">)$ 当 $X_0 = \, </span><span class="si">{</span><span class="n">x0</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;$\hat p_n(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">)$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="_images/066ab756ee66ad541f4f26a27f6a182452693d6fb2d0483ff96bcf0c1a8e702a.png"><img alt="_images/066ab756ee66ad541f4f26a27f6a182452693d6fb2d0483ff96bcf0c1a8e702a.png" src="_images/066ab756ee66ad541f4f26a27f6a182452693d6fb2d0483ff96bcf0c1a8e702a.png" style="width: 80%;" /></a>
</div>
</div>
<p>你可能想尝试将 <span class="math notranslate nohighlight">\(x=1\)</span> 改为 <span class="math notranslate nohighlight">\(x=0\)</span> 或 <span class="math notranslate nohighlight">\(x=2\)</span>。</p>
<p>在这些情况下，遍历性都会成立。</p>
</section>
<section id="id10">
<h3><span class="section-number">34.3.3. </span>示例：一个周期链<a class="headerlink" href="#id10" title="Permalink to this heading">#</a></h3>
<div class="proof example admonition" id="mc2_ex_pc">
<p class="admonition-title"><span class="caption-number">Example 34.3 </span></p>
<section class="example-content" id="proof-content">
<p>让我们来看以下状态0和1的例子：</p>
<div class="math notranslate nohighlight">
\[\begin{split}
P :=
\begin{bmatrix} 
     0 &amp; 1\\
     1 &amp; 0\\
\end{bmatrix} 
\end{split}\]</div>
<p>转移图表明该模型是不可约的。</p>
<img alt="_images/example4.png" class="align-center" id="mc-example4" src="_images/example4.png" />
<p>请注意，这里有一个周期循环——当前状态以规则的方式在两个状态之间循环。</p>
</section>
</div><p>毫不奇怪，这种属性被称为<a class="reference external" href="https://stats.libretexts.org/Bookshelves/Probability_Theory/Probability_Mathematical_Statistics_and_Stochastic_Processes_(Siegrist)/16%3A_Markov_Processes/16.05%3A_Periodicity_of_Discrete-Time_Chains">周期性</a>。</p>
<p>尽管如此，该模型是不可约的，因此遍历性成立。</p>
<p>以下图表进行了说明：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="n">ts_length</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">qe</span><span class="o">.</span><span class="n">MarkovChain</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">ψ_star</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">stationary_distributions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">ψ_star</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                    <span class="n">label</span> <span class="o">=</span> <span class="sa">fr</span><span class="s1">&#39;$\psi^*(</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">)$&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;$\hat p_n(</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">)$&#39;</span><span class="p">)</span>

    <span class="c1"># 计算每个 x 花费的时间比例</span>
    <span class="k">for</span> <span class="n">x0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="c1"># 从不同的 x_0 生成时间序列</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">ts_length</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">x0</span><span class="p">)</span>
        <span class="n">p_hat</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ts_length</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p_hat</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$x_0 = \, </span><span class="si">{</span><span class="n">x0</span><span class="si">}</span><span class="s1"> $&#39;</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="_images/4b6f6501fe917971cc882cd9c1e9beab89b635e6be7f6d45f20b70e3f4836f56.png"><img alt="_images/4b6f6501fe917971cc882cd9c1e9beab89b635e6be7f6d45f20b70e3f4836f56.png" src="_images/4b6f6501fe917971cc882cd9c1e9beab89b635e6be7f6d45f20b70e3f4836f56.png" style="width: 80%;" /></a>
</div>
</div>
<p>该示例帮助强调了渐近平稳性是关于分布的，而遍历性是关于样本路径的。</p>
<p>在周期性链中，花费在某个状态的时间比例可以收敛到平稳分布。然而，每个状态的分布却不会收敛。</p>
</section>
<section id="id11">
<h3><span class="section-number">34.3.4. </span>示例：政治制度<a class="headerlink" href="#id11" title="Permalink to this heading">#</a></h3>
<p>让我们回到<a class="reference internal" href="markov_chains_I.html#mc-eg3"><span class="std std-ref">前一讲中讨论的</span></a>具有六个状态的政治制度模型，并研究其遍历性。</p>
<p>以下是转移矩阵：</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    P :=
    \begin{bmatrix} 
        0.86 &amp; 0.11 &amp; 0.03 &amp; 0.00 &amp; 0.00 &amp; 0.00 \\
        0.52 &amp; 0.33 &amp; 0.13 &amp; 0.02 &amp; 0.00 &amp; 0.00 \\
        0.12 &amp; 0.03 &amp; 0.70 &amp; 0.11 &amp; 0.03 &amp; 0.01 \\
        0.13 &amp; 0.02 &amp; 0.35 &amp; 0.36 &amp; 0.10 &amp; 0.04 \\
        0.00 &amp; 0.00 &amp; 0.09 &amp; 0.11 &amp; 0.55 &amp; 0.25 \\
        0.00 &amp; 0.00 &amp; 0.09 &amp; 0.15 &amp; 0.26 &amp; 0.50
    \end{bmatrix} 
\end{split}\]</div>
<p>链的<a class="reference internal" href="markov_chains_I.html#mc-eg3"><span class="std std-ref">图</span></a>显示所有状态都是可达的，表明该链是不可约的。</p>
<p>在下图中，我们可视化了每个状态 <span class="math notranslate nohighlight">\(x\)</span> 的 <span class="math notranslate nohighlight">\(\hat p_n(x) - \psi^* (x)\)</span> 差异。</p>
<p>与前一个图不同，<span class="math notranslate nohighlight">\(X_0\)</span> 是固定的。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.86</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">],</span>
     <span class="p">[</span><span class="mf">0.52</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">],</span>
     <span class="p">[</span><span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.70</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">],</span>
     <span class="p">[</span><span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.36</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">],</span>
     <span class="p">[</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span>
     <span class="p">[</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">]]</span>

<span class="n">ts_length</span> <span class="o">=</span> <span class="mi">2500</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">qe</span><span class="o">.</span><span class="n">MarkovChain</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="n">ψ_star</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">stationary_distributions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">ts_length</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># 将图中心对准0</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)):</span>
    <span class="c1"># 计算每个状态的时间比例</span>
    <span class="n">p_hat</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">==</span> <span class="n">x0</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ts_length</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p_hat</span> <span class="o">-</span> <span class="n">ψ_star</span><span class="p">[</span><span class="n">x0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;$x = </span><span class="si">{</span><span class="n">x0</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> $&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\hat p_n(x) - \psi^* (x)$&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="_images/edfef7dfaa35c7308d7d19a8c6ad5844b37e15dd48266191fa9c121aea0835d0.png"><img alt="_images/edfef7dfaa35c7308d7d19a8c6ad5844b37e15dd48266191fa9c121aea0835d0.png" src="_images/edfef7dfaa35c7308d7d19a8c6ad5844b37e15dd48266191fa9c121aea0835d0.png" style="width: 80%;" /></a>
</div>
</div>
</section>
</section>
<section id="id12">
<h2><span class="section-number">34.4. </span>练习<a class="headerlink" href="#id12" title="Permalink to this heading">#</a></h2>
<div class="exercise admonition" id="mc_ex1">

<p class="admonition-title"><span class="caption-number">Exercise 34.1 </span></p>
<section id="exercise-content">
<p>Benhabib 等人 <span id="id13">[<a class="reference internal" href="zreferences.html#id278" title="Jess Benhabib, Alberto Bisin, and Mi Luo. Wealth Distribution and Social Mobility in the US: A Quantitative Approach. American Economic Review, 109(5):1623–1647, May 2019.">Benhabib <em>et al.</em>, 2019</a>]</span> 估计了如下的社会流动性转移矩阵：</p>
<div class="math notranslate nohighlight">
\[\begin{split}
P:=
    \begin{bmatrix} 
        0.222 &amp; 0.222 &amp; 0.215 &amp; 0.187 &amp; 0.081 &amp; 0.038 &amp; 0.029 &amp; 0.006 \\
        0.221 &amp; 0.22 &amp; 0.215 &amp; 0.188 &amp; 0.082 &amp; 0.039 &amp; 0.029 &amp; 0.006 \\
        0.207 &amp; 0.209 &amp; 0.21 &amp; 0.194 &amp; 0.09 &amp; 0.046 &amp; 0.036 &amp; 0.008 \\ 
        0.198 &amp; 0.201 &amp; 0.207 &amp; 0.198 &amp; 0.095 &amp; 0.052 &amp; 0.04 &amp; 0.009 \\ 
        0.175 &amp; 0.178 &amp; 0.197 &amp; 0.207 &amp; 0.11 &amp; 0.067 &amp; 0.054 &amp; 0.012 \\ 
        0.182 &amp; 0.184 &amp; 0.2 &amp; 0.205 &amp; 0.106 &amp; 0.062 &amp; 0.05 &amp; 0.011 \\ 
        0.123 &amp; 0.125 &amp; 0.166 &amp; 0.216 &amp; 0.141 &amp; 0.114 &amp; 0.094 &amp; 0.021 \\ 
        0.084 &amp; 0.084 &amp; 0.142 &amp; 0.228 &amp; 0.17 &amp; 0.143 &amp; 0.121 &amp; 0.028
\end{bmatrix} 
\end{split}\]</div>
<p>其中每个状态1到8对应于财富份额的百分位数：</p>
<div class="math notranslate nohighlight">
\[
0-20 \%, 20-40 \%, 40-60 \%, 60-80 \%, 80-90 \%, 90-95 \%, 95-99 \%, 99-100 \%
\]</div>
<p>矩阵记录为 <code class="docutils literal notranslate"><span class="pre">P</span></code>，如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mf">0.222</span><span class="p">,</span> <span class="mf">0.222</span><span class="p">,</span> <span class="mf">0.215</span><span class="p">,</span> <span class="mf">0.187</span><span class="p">,</span> <span class="mf">0.081</span><span class="p">,</span> <span class="mf">0.038</span><span class="p">,</span> <span class="mf">0.029</span><span class="p">,</span> <span class="mf">0.006</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.221</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span>  <span class="mf">0.215</span><span class="p">,</span> <span class="mf">0.188</span><span class="p">,</span> <span class="mf">0.082</span><span class="p">,</span> <span class="mf">0.039</span><span class="p">,</span> <span class="mf">0.029</span><span class="p">,</span> <span class="mf">0.006</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.207</span><span class="p">,</span> <span class="mf">0.209</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span>  <span class="mf">0.194</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">,</span>  <span class="mf">0.046</span><span class="p">,</span> <span class="mf">0.036</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.198</span><span class="p">,</span> <span class="mf">0.201</span><span class="p">,</span> <span class="mf">0.207</span><span class="p">,</span> <span class="mf">0.198</span><span class="p">,</span> <span class="mf">0.095</span><span class="p">,</span> <span class="mf">0.052</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span>  <span class="mf">0.009</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.175</span><span class="p">,</span> <span class="mf">0.178</span><span class="p">,</span> <span class="mf">0.197</span><span class="p">,</span> <span class="mf">0.207</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span>  <span class="mf">0.067</span><span class="p">,</span> <span class="mf">0.054</span><span class="p">,</span> <span class="mf">0.012</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.182</span><span class="p">,</span> <span class="mf">0.184</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span>   <span class="mf">0.205</span><span class="p">,</span> <span class="mf">0.106</span><span class="p">,</span> <span class="mf">0.062</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span>  <span class="mf">0.011</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.123</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.166</span><span class="p">,</span> <span class="mf">0.216</span><span class="p">,</span> <span class="mf">0.141</span><span class="p">,</span> <span class="mf">0.114</span><span class="p">,</span> <span class="mf">0.094</span><span class="p">,</span> <span class="mf">0.021</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.084</span><span class="p">,</span> <span class="mf">0.084</span><span class="p">,</span> <span class="mf">0.142</span><span class="p">,</span> <span class="mf">0.228</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span>  <span class="mf">0.143</span><span class="p">,</span> <span class="mf">0.121</span><span class="p">,</span> <span class="mf">0.028</span><span class="p">]</span>
    <span class="p">]</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="n">codes_B</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;5&#39;</span><span class="p">,</span><span class="s1">&#39;6&#39;</span><span class="p">,</span><span class="s1">&#39;7&#39;</span><span class="p">,</span><span class="s1">&#39;8&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>证明该过程是渐近平稳的，并计算平稳分布的近似值。</p></li>
<li><p>使用模拟来说明遍历性。</p></li>
</ol>
</section>
</div>
<div class="solution dropdown admonition" id="markov_chains_II-solution-6">

<p class="admonition-title">Solution to<a class="reference internal" href="#mc_ex1"> Exercise 34.1</a></p>
<section id="solution-content">
<p>第1部分：</p>
<p>一种选择是对转移矩阵取幂。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.222</span><span class="p">,</span> <span class="mf">0.222</span><span class="p">,</span> <span class="mf">0.215</span><span class="p">,</span> <span class="mf">0.187</span><span class="p">,</span> <span class="mf">0.081</span><span class="p">,</span> <span class="mf">0.038</span><span class="p">,</span> <span class="mf">0.029</span><span class="p">,</span> <span class="mf">0.006</span><span class="p">],</span>
     <span class="p">[</span><span class="mf">0.221</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span>  <span class="mf">0.215</span><span class="p">,</span> <span class="mf">0.188</span><span class="p">,</span> <span class="mf">0.082</span><span class="p">,</span> <span class="mf">0.039</span><span class="p">,</span> <span class="mf">0.029</span><span class="p">,</span> <span class="mf">0.006</span><span class="p">],</span>
     <span class="p">[</span><span class="mf">0.207</span><span class="p">,</span> <span class="mf">0.209</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span>  <span class="mf">0.194</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">,</span>  <span class="mf">0.046</span><span class="p">,</span> <span class="mf">0.036</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">],</span>
     <span class="p">[</span><span class="mf">0.198</span><span class="p">,</span> <span class="mf">0.201</span><span class="p">,</span> <span class="mf">0.207</span><span class="p">,</span> <span class="mf">0.198</span><span class="p">,</span> <span class="mf">0.095</span><span class="p">,</span> <span class="mf">0.052</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span>  <span class="mf">0.009</span><span class="p">],</span>
     <span class="p">[</span><span class="mf">0.175</span><span class="p">,</span> <span class="mf">0.178</span><span class="p">,</span> <span class="mf">0.197</span><span class="p">,</span> <span class="mf">0.207</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span>  <span class="mf">0.067</span><span class="p">,</span> <span class="mf">0.054</span><span class="p">,</span> <span class="mf">0.012</span><span class="p">],</span>
     <span class="p">[</span><span class="mf">0.182</span><span class="p">,</span> <span class="mf">0.184</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span>   <span class="mf">0.205</span><span class="p">,</span> <span class="mf">0.106</span><span class="p">,</span> <span class="mf">0.062</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span>  <span class="mf">0.011</span><span class="p">],</span>
     <span class="p">[</span><span class="mf">0.123</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.166</span><span class="p">,</span> <span class="mf">0.216</span><span class="p">,</span> <span class="mf">0.141</span><span class="p">,</span> <span class="mf">0.114</span><span class="p">,</span> <span class="mf">0.094</span><span class="p">,</span> <span class="mf">0.021</span><span class="p">],</span>
     <span class="p">[</span><span class="mf">0.084</span><span class="p">,</span> <span class="mf">0.084</span><span class="p">,</span> <span class="mf">0.142</span><span class="p">,</span> <span class="mf">0.228</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span>  <span class="mf">0.143</span><span class="p">,</span> <span class="mf">0.121</span><span class="p">,</span> <span class="mf">0.028</span><span class="p">]]</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="n">codes_B</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;5&#39;</span><span class="p">,</span><span class="s1">&#39;6&#39;</span><span class="p">,</span><span class="s1">&#39;7&#39;</span><span class="p">,</span><span class="s1">&#39;8&#39;</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">matrix_power</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.20254451, 0.20379879, 0.20742102, 0.19505842, 0.09287832,
        0.0503871 , 0.03932382, 0.00858802],
       [0.20254451, 0.20379879, 0.20742102, 0.19505842, 0.09287832,
        0.0503871 , 0.03932382, 0.00858802],
       [0.20254451, 0.20379879, 0.20742102, 0.19505842, 0.09287832,
        0.0503871 , 0.03932382, 0.00858802],
       [0.20254451, 0.20379879, 0.20742102, 0.19505842, 0.09287832,
        0.0503871 , 0.03932382, 0.00858802],
       [0.20254451, 0.20379879, 0.20742102, 0.19505842, 0.09287832,
        0.0503871 , 0.03932382, 0.00858802],
       [0.20254451, 0.20379879, 0.20742102, 0.19505842, 0.09287832,
        0.0503871 , 0.03932382, 0.00858802],
       [0.20254451, 0.20379879, 0.20742102, 0.19505842, 0.09287832,
        0.0503871 , 0.03932382, 0.00858802],
       [0.20254451, 0.20379879, 0.20742102, 0.19505842, 0.09287832,
        0.0503871 , 0.03932382, 0.00858802]])
</pre></div>
</div>
</div>
</div>
<p>对于此模型，当 <span class="math notranslate nohighlight">\(n \to \infty\)</span> 时，<span class="math notranslate nohighlight">\(P^n\)</span> 的行收敛到平稳分布：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mc</span> <span class="o">=</span> <span class="n">qe</span><span class="o">.</span><span class="n">MarkovChain</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="n">ψ_star</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">stationary_distributions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ψ_star</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.20254451, 0.20379879, 0.20742102, 0.19505842, 0.09287832,
       0.0503871 , 0.03932382, 0.00858802])
</pre></div>
</div>
</div>
</div>
<p>第2部分：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_length</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">qe</span><span class="o">.</span><span class="n">MarkovChain</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">ts_length</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)):</span>
    <span class="c1"># 计算每个工人的时间比例</span>
    <span class="n">p_hat</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">==</span> <span class="n">x0</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ts_length</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p_hat</span> <span class="o">-</span> <span class="n">ψ_star</span><span class="p">[</span><span class="n">x0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;$x = </span><span class="si">{</span><span class="n">x0</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> $&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\hat p_n(x) - \psi^* (x)$&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="_images/5ac3db48e7be0976893752b1833126931cb7c69b2234e8009227c1ef91d7e3d9.png"><img alt="_images/5ac3db48e7be0976893752b1833126931cb7c69b2234e8009227c1ef91d7e3d9.png" src="_images/5ac3db48e7be0976893752b1833126931cb7c69b2234e8009227c1ef91d7e3d9.png" style="width: 80%;" /></a>
</div>
</div>
<p>注意，花费在每个状态的时间比例收敛到对应平稳分布下该状态的概率。</p>
</section>
</div>
<div class="exercise admonition" id="mc_ex2">

<p class="admonition-title"><span class="caption-number">Exercise 34.2 </span></p>
<section id="exercise-content">
<p>根据<a class="reference internal" href="#mc-eg1-2"><span class="std std-ref">上述讨论</span></a>，如果一个工人的就业动态遵循以下随机矩阵</p>
<div class="math notranslate nohighlight">
\[\begin{split}
P := 
\begin{bmatrix} 
1 - \alpha &amp; \alpha \\
\beta &amp; 1 - \beta
\end{bmatrix} 
\end{split}\]</div>
<p>其中 <span class="math notranslate nohighlight">\(\alpha \in (0,1)\)</span> 且 <span class="math notranslate nohighlight">\(\beta \in (0,1)\)</span>，那么，从长远来看，失业的时间比例将为</p>
<div class="math notranslate nohighlight">
\[
p := \frac{\beta}{\alpha + \beta}
\]</div>
<p>换句话说，如果 <span class="math notranslate nohighlight">\(\{X_t\}\)</span> 表示就业状态的马尔科夫链，那么当 <span class="math notranslate nohighlight">\(m \to \infty\)</span>， <span class="math notranslate nohighlight">\(\bar X_m \to p\)</span>，其中</p>
<div class="math notranslate nohighlight">
\[
\bar X_m := \frac{1}{m} \sum_{t = 1}^m \mathbb{1}\{X_t = 0\}
\]</div>
<p>本练习要求您通过计算 <span class="math notranslate nohighlight">\(m\)</span> 充分大时的 <span class="math notranslate nohighlight">\(\bar X_m\)</span> 来说明收敛性，并检查其是否接近 <span class="math notranslate nohighlight">\(p\)</span>。</p>
<p>会看到无论初始条件或 <span class="math notranslate nohighlight">\(\alpha, \beta\)</span> 的值如何，只要它们都位于 <span class="math notranslate nohighlight">\((0,1)\)</span> 区间内，此结论都成立。</p>
<p>结果应与我们在<a class="reference internal" href="#ergo"><span class="std std-ref">这里</span></a>绘制的图类似。</p>
</section>
</div>
<div class="solution dropdown admonition" id="markov_chains_II-solution-8">

<p class="admonition-title">Solution to<a class="reference internal" href="#mc_ex2"> Exercise 34.2</a></p>
<section id="solution-content">
<p>我们将以图形方式解决此练习。</p>
<p>图显示了对于两个初始条件 <span class="math notranslate nohighlight">\(\bar X_m - p\)</span> 的时间序列。</p>
<p>当 <span class="math notranslate nohighlight">\(m\)</span> 变大时，两个序列都收敛到零。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">α</span> <span class="o">=</span> <span class="n">β</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">ts_length</span> <span class="o">=</span> <span class="mi">3000</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">β</span> <span class="o">/</span> <span class="p">(</span><span class="n">α</span> <span class="o">+</span> <span class="n">β</span><span class="p">)</span>

<span class="n">P</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">α</span><span class="p">,</span>       <span class="n">α</span><span class="p">),</span>               <span class="c1"># 注意：P 和 p 是不同的</span>
     <span class="p">(</span>    <span class="n">β</span><span class="p">,</span>   <span class="mi">1</span> <span class="o">-</span> <span class="n">β</span><span class="p">))</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">qe</span><span class="o">.</span><span class="n">MarkovChain</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)):</span>
    <span class="c1"># 为每个从 x0 开始的工人生成时间序列</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">ts_length</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">x0</span><span class="p">)</span>
    <span class="c1"># 计算每个 n 的失业时间比例</span>
    <span class="n">X_bar</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ts_length</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># 绘图</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_bar</span> <span class="o">-</span> <span class="n">p</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$x_0 = \, </span><span class="si">{</span><span class="n">x0</span><span class="si">}</span><span class="s1"> $&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\bar X_m - \psi^* (x)$&#39;</span><span class="p">)</span>
    
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="_images/9d6c63b12d3121fef661a6bde85255cc6b82ca53ad8705255927b1bfc6ad6661.png"><img alt="_images/9d6c63b12d3121fef661a6bde85255cc6b82ca53ad8705255927b1bfc6ad6661.png" src="_images/9d6c63b12d3121fef661a6bde85255cc6b82ca53ad8705255927b1bfc6ad6661.png" style="width: 80%;" /></a>
</div>
</div>
</section>
</div>
<div class="exercise admonition" id="mc_ex3">

<p class="admonition-title"><span class="caption-number">Exercise 34.3 </span></p>
<section id="exercise-content">
<p>在 <code class="docutils literal notranslate"><span class="pre">quantecon</span></code> 库中，通过检查链是否形成<a class="reference external" href="https://networkx.org/documentation/stable/reference/algorithms/generated/networkx.algorithms.components.is_strongly_connected.html">强连通分量</a>来测试不可约性。</p>
<p>另一种测试不可约性的方法是通过以下定理：</p>
<p>当且仅当 <span class="math notranslate nohighlight">\(\sum_{k=0}^{n-1}A^k\)</span> 是严格正矩阵时，<span class="math notranslate nohighlight">\(n \times n\)</span> 矩阵 <span class="math notranslate nohighlight">\(A\)</span> 是不可约的。</p>
<p>（参见<span id="id14">[<a class="reference internal" href="zreferences.html#id277" title="Dongmei Zhao. Power Distribution and Performance Analysis for Wireless Communication Networks. SpringerBriefs in Computer Science. Springer US, Boston, MA, 2012. ISBN 978-1-4614-3283-8 978-1-4614-3284-5. URL: https://link.springer.com/10.1007/978-1-4614-3284-5 (visited on 2023-02-03), doi:10.1007/978-1-4614-3284-5.">Zhao, 2012</a>]</span> 和 <a class="reference external" href="https://math.stackexchange.com/questions/3336616/how-to-prove-this-matrix-is-a-irreducible-matrix">此 StackExchange 讨论</a>）</p>
<p>根据此定理，编写一个函数来测试不可约性。</p>
</section>
</div>
<div class="solution dropdown admonition" id="markov_chains_II-solution-10">

<p class="admonition-title">Solution to<a class="reference internal" href="#mc_ex3"> Exercise 34.3</a></p>
<section id="solution-content">
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">is_irreducible</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">matrix_power</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>让我们尝试一下。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="n">P2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
               <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
               <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]])</span>
<span class="n">P3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.971</span><span class="p">,</span> <span class="mf">0.029</span><span class="p">,</span> <span class="mf">0.000</span><span class="p">],</span>
               <span class="p">[</span><span class="mf">0.145</span><span class="p">,</span> <span class="mf">0.778</span><span class="p">,</span> <span class="mf">0.077</span><span class="p">],</span>
               <span class="p">[</span><span class="mf">0.000</span><span class="p">,</span> <span class="mf">0.508</span><span class="p">,</span> <span class="mf">0.492</span><span class="p">]])</span>

<span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">P</span><span class="p">:</span> <span class="s1">&#39;不可约&#39;</span> <span class="k">if</span> <span class="n">is_irreducible</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;可约&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">P</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">result</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[0 1]
 [1 0]]: 不可约
[[1.  0.  0. ]
 [0.1 0.8 0.1]
 [0.  0.2 0.8]]: 可约
[[0.971 0.029 0.   ]
 [0.145 0.778 0.077]
 [0.    0.508 0.492]]: 不可约
</pre></div>
</div>
</div>
</div>
</section>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                    <p>A theme by <a href="https://quantecon.org">QuantEcon</a></p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  导言
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="about.html">
   1. 关于这些讲座
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  经济数据
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="long_run_growth.html">
   2. 长期增长
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="business_cycle.html">
   3. 商业周期
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="inflation_history.html">
   4. 价格水平历史
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="french_rev.html">
   5. 法国大革命期间的通货膨胀
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="inequality.html">
   6. 收入与财富不平等
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  基础工具
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="intro_supply_demand.html">
   7. 供给与需求导论
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_equations.html">
   8. 线性方程和矩阵代数
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="complex_and_trig.html">
   9. 复数和三角函数
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="geom_series.html">
   10. 基础经济学中的几何级数
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  线性动态：有限视界
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="pv.html">
   11. 现值
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cons_smooth.html">
   12. 消费平滑
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="equalizing_difference.html">
   13. 均衡差异模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cagan_ree.html">
   14. 价格水平的货币主义理论
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cagan_adaptive.html">
   15. 具有自适应预期的价格水平货币主义理论
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  线性动态：无限视界
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="eigen_I.html">
   16. 特征值和特征向量
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="greek_square.html">
   17. 计算平方根
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  概率与分布
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="prob_dist.html">
   18. 分布和概率
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lln_clt.html">
   19. 大数定律与中心极限定理
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="monte_carlo.html">
   20. 蒙特卡罗方法与期权定价
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="heavy_tails.html">
   21. 重尾分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="schelling.html">
   22. 种族隔离
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  非线性动态
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="scalar_dynam.html">
   23. 一维动力学
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="solow.html">
   24. 索洛-斯旺增长模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cobweb.html">
   25. 蛛网模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="olg.html">
   26. 世代交叠模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="commod_price.html">
   27. 商品价格
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  货币政策与财政政策的相互作用
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="money_inflation.html">
   28. 通过货币资助的政府赤字和价格水平
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="unpleasant.html">
   29. 一些不愉快的货币主义算术
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="money_inflation_nonlinear.html">
   30. 通货膨胀税拉弗曲线
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="laffer_adaptive.html">
   31. 拉弗曲线与自适应预期
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  随机动态
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_processes.html">
   32. AR(1) 过程
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_chains_I.html">
   33. 马尔科夫链：基本概念
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   34. 马尔科夫链：不可约性与遍历性
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="time_series_with_matrices.html">
   35. 用矩阵代数表示的单变量时间序列
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  优化
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lp_intro.html">
   36. 线性规划
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="short_path.html">
   37. 最短路径
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  高维建模
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="eigen_II.html">
   38. 佩龙-弗罗贝尼乌斯定理
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="input_output.html">
   39. 输入-输出模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lake_model.html">
   40. 就业的湖泊模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="networks.html">
   41. 网络
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  市场与竞争性均衡
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="supply_demand_multiple_goods.html">
   42. 多种商品的供需关系
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="supply_demand_heterogeneity.html">
   43. 市场均衡与异质性
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  估计
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="simple_linear_regression.html">
   44. 简单线性回归模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mle.html">
   45. 最大似然估计
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  其它
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   46. 故障排除
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   47. 参考文献
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   48. 执行统计数据
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                </ul>

                <ul class="qe-toolbar__links">
                    <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off" accesskey="k">
                            <i data-feather="search" id="search-icon"></i>
                        </form>
                    </li>
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="https://quantecon.github.io/lecture-intro.zh-cn/_notebooks/markov_chains_II.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li data-tippy-content="Download PDF" onClick="window.print()"><i data-feather="file"></i></li>
                    <!--
                    # Enable if looking for link to specific document hosted on GitHub
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-intro.zh-cn/blob/main/lectures/markov_chains_II.md" download><i data-feather="github"></i></a></li>
                    -->
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-intro.zh-cn" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://mybinder.org/v2/gh/QuantEcon/lecture-intro.zh-cn.notebooks/main?urlpath=tree/markov_chains_II.ipynb">BinderHub</option>
                
                    <option value="https://colab.research.google.com/github/QuantEcon/lecture-intro.zh-cn.notebooks/blob/main/markov_chains_II.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-intro.zh-cn.notebooks" data-urlpath="tree/lecture-intro.zh-cn.notebooks/markov_chains_II.ipynb" data-branch=main>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://colab.research.google.com/github/QuantEcon/lecture-intro.zh-cn.notebooks/blob/main/markov_chains_II.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "markov_chains_II";
                const repoURL = "https://github.com/QuantEcon/lecture-intro.zh-cn.notebooks";
                const urlPath = "tree/lecture-intro.zh-cn.notebooks/markov_chains_II.ipynb";
                const branch = "main"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>